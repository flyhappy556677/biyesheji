{"ast":null,"code":"export default {\n  name: 'addMaintenance',\n  data() {\n    return {\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\n      form: {\n        userName: '',\n        droneName: '',\n        address: '',\n        phone: '',\n        createtime: ''\n      },\n      rules: {\n        userName: [{\n          required: true,\n          message: '请输入操作用户',\n          trigger: 'blur'\n        }],\n        droneName: [{\n          required: true,\n          message: '请输入无人机名字',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created() {\n    const orderId = this.$route.query.id;\n    this.request.get(\"/buyorder/\" + orderId).then(res => {\n      this.form = res.data;\n      console.log(this.form);\n    });\n    const user = JSON.parse(localStorage.getItem(\"user\"));\n    if (user) {\n      // 如果缓存中存在用户数据，则将用户名和无人机名称填充到表单中\n      this.form.userName = user.username || '';\n    }\n  },\n  methods: {\n    save() {\n      // 在此处添加其他字段的验证规则\n      this.$refs.ruleForm.validate(valid => {\n        if (valid) {\n          // 验证通过，执行保存逻辑\n          this.form.status = true; // 例如将 status 设置为 true\n          this.form.userId = this.user.id;\n          this.request.post('/maintenance', {\n            ...this.form,\n            orderId: this.$route.query.id\n          }).then(res => {\n            if (res.code === '200') {\n              this.$notify.success('更新成功');\n            } else {\n              this.$notify.error(res.msg);\n            }\n          }).catch(error => {\n            console.error('保存出错:', error);\n            this.$notify.error('保存出错，请稍后重试');\n          });\n        } else {\n          // 验证不通过，停止保存并提示用户\n          return false;\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["name","data","user","localStorage","getItem","JSON","parse","form","userName","droneName","address","phone","createtime","rules","required","message","trigger","created","orderId","$route","query","id","request","get","then","res","console","log","username","methods","save","$refs","ruleForm","validate","valid","status","userId","post","code","$notify","success","error","msg","catch"],"sources":["src/views/addMaintenance.vue"],"sourcesContent":["<template>\r\n  <el-form :model=\"form\" :rules=\"rules\" ref=\"ruleForm\" :inline=\"true\" style=\"width: 70%\" label-width=\"100px\">\r\n\r\n    <el-form-item label=\"操作用户\" prop=\"userName\">\r\n      <el-input v-model=\"form.userName\" disabled placeholder=\"请输入无人机名称\"></el-input>\r\n    </el-form-item>\r\n\r\n    <el-form-item label=\"无人机名字\" prop=\"droneName\">\r\n      <el-input v-model=\"form.droneName\" disabled placeholder=\"请输入无人机名字\"></el-input>\r\n    </el-form-item>\r\n\r\n    <el-form-item label=\"操作地址\" prop=\"address\">\r\n      <el-input style=\"width:400px\" v-model=\"form.address\"  placeholder=\"请输入描述\"></el-input>\r\n    </el-form-item>\r\n\r\n    <el-form-item label=\"手机号码\" prop=\"phone\">\r\n      <el-input style=\"width:400px\" v-model=\"form.phone\"  placeholder=\"请输入描述\"></el-input>\r\n    </el-form-item>\r\n\r\n    <el-form-item label=\"保养提交时间\" prop=\"createtime\">\r\n      <el-date-picker\r\n          v-model=\"form.createtime\"\r\n          type=\"date\"\r\n          value-format=\"yyyy-MM-dd\"\r\n          placeholder=\"保养提交时间\">\r\n      </el-date-picker>\r\n    </el-form-item>\r\n\r\n    <div style=\"text-align:center; margin-top:30px;\">\r\n      <el-button type=\"primary\" @click=\"save\">提交</el-button>\r\n      <el-button type=\"danger\">取消</el-button>\r\n    </div>\r\n\r\n  </el-form>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'addMaintenance',\r\n  data() {\r\n    return {\r\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\r\n      form: {\r\n        userName: '',\r\n        droneName: '',\r\n        address: '',\r\n        phone: '',\r\n        createtime: ''\r\n      },\r\n      rules: {\r\n        userName: [{ required: true, message: '请输入操作用户', trigger: 'blur' }],\r\n        droneName: [{ required: true, message: '请输入无人机名字', trigger: 'blur' }]\r\n      }\r\n    };\r\n  },\r\n  created() {\r\n        const orderId = this.$route.query.id;\r\n        this.request.get(\"/buyorder/\"+orderId).then(res =>{\r\n          this.form =res.data\r\n          console.log(this.form)\r\n        })\r\n        const user = JSON.parse(localStorage.getItem(\"user\"));\r\n        if (user) {\r\n          // 如果缓存中存在用户数据，则将用户名和无人机名称填充到表单中\r\n          this.form.userName = user.username || '';\r\n        }\r\n      },\r\n\r\n  methods: {\r\n    save() {\r\n      // 在此处添加其他字段的验证规则\r\n      this.$refs.ruleForm.validate((valid) => {\r\n        if (valid) {\r\n          // 验证通过，执行保存逻辑\r\n          this.form.status = true; // 例如将 status 设置为 true\r\n          this.form.userId = this.user.id ;\r\n          this.request.post('/maintenance', { ...this.form, orderId: this.$route.query.id })\r\n              .then(res => {\r\n                if (res.code === '200') {\r\n                  this.$notify.success('更新成功');\r\n                } else {\r\n                  this.$notify.error(res.msg);\r\n                }\r\n              })\r\n              .catch(error => {\r\n                console.error('保存出错:', error);\r\n                this.$notify.error('保存出错，请稍后重试');\r\n              });\r\n        } else {\r\n          // 验证不通过，停止保存并提示用户\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n"],"mappings":"AAqCA;EACAA,IAAA;EACAC,KAAA;IACA;MACAC,IAAA,EAAAC,YAAA,CAAAC,OAAA,WAAAC,IAAA,CAAAC,KAAA,CAAAH,YAAA,CAAAC,OAAA;MACAG,IAAA;QACAC,QAAA;QACAC,SAAA;QACAC,OAAA;QACAC,KAAA;QACAC,UAAA;MACA;MACAC,KAAA;QACAL,QAAA;UAAAM,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAP,SAAA;UAAAK,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;MACA;IACA;EACA;EACAC,QAAA;IACA,MAAAC,OAAA,QAAAC,MAAA,CAAAC,KAAA,CAAAC,EAAA;IACA,KAAAC,OAAA,CAAAC,GAAA,gBAAAL,OAAA,EAAAM,IAAA,CAAAC,GAAA;MACA,KAAAlB,IAAA,GAAAkB,GAAA,CAAAxB,IAAA;MACAyB,OAAA,CAAAC,GAAA,MAAApB,IAAA;IACA;IACA,MAAAL,IAAA,GAAAG,IAAA,CAAAC,KAAA,CAAAH,YAAA,CAAAC,OAAA;IACA,IAAAF,IAAA;MACA;MACA,KAAAK,IAAA,CAAAC,QAAA,GAAAN,IAAA,CAAA0B,QAAA;IACA;EACA;EAEAC,OAAA;IACAC,KAAA;MACA;MACA,KAAAC,KAAA,CAAAC,QAAA,CAAAC,QAAA,CAAAC,KAAA;QACA,IAAAA,KAAA;UACA;UACA,KAAA3B,IAAA,CAAA4B,MAAA;UACA,KAAA5B,IAAA,CAAA6B,MAAA,QAAAlC,IAAA,CAAAmB,EAAA;UACA,KAAAC,OAAA,CAAAe,IAAA;YAAA,QAAA9B,IAAA;YAAAW,OAAA,OAAAC,MAAA,CAAAC,KAAA,CAAAC;UAAA,GACAG,IAAA,CAAAC,GAAA;YACA,IAAAA,GAAA,CAAAa,IAAA;cACA,KAAAC,OAAA,CAAAC,OAAA;YACA;cACA,KAAAD,OAAA,CAAAE,KAAA,CAAAhB,GAAA,CAAAiB,GAAA;YACA;UACA,GACAC,KAAA,CAAAF,KAAA;YACAf,OAAA,CAAAe,KAAA,UAAAA,KAAA;YACA,KAAAF,OAAA,CAAAE,KAAA;UACA;QACA;UACA;UACA;QACA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}